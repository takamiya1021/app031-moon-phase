# 📋 要件定義書：No.31「月の満ち欠け表示」

**作成日**: 2025-01-13
**バージョン**: 1.0
**アプリ番号**: 31

---

## 1. プロジェクト概要

### 1.1 アプリ名
**月の満ち欠け表示（Moon Phase Viewer）**

### 1.2 目的・課題
- **解決したい課題**: 「今日の月ってどんな感じかな」を気軽に知りたい
- **ターゲットユーザー**: 月を見て落ち着きたい、心理的な癒しを求める人
- **利用シーン**: 興味本位で月を確認したい時、リラックスしたい時
- **コンセプト**: 学習ツールではなく、心理的な癒し・興味を満たすビューア

### 1.3 成功基準
- 見ていて気持ちが良い、リッチなビジュアル体験
- 直感的に今日の月の状態がわかる
- 月にまつわる情報で癒しや興味を満たす

---

## 2. 必須要件（中期以降の方針）

### 2.1 AI内蔵アプリケーション
- ✅ Google AI Studio API使用
- ✅ 月にまつわる豆知識生成
- ✅ その日に合わせた運勢メッセージ生成
- ✅ 月の観測アドバイス生成

### 2.2 PWA標準実装
- ✅ オフライン対応
  - **月の計算**: オフラインでも動作
  - **AI生成**: オンライン必須（オフライン時はエラー表示）
- ✅ インストール可能
- ✅ レスポンシブデザイン

### 2.3 既存アプリとの連携
- ✅ **28番「星の名前クイズ」と連携**
  - **目的**: 星や月の位置関係を表示
  - **連携方法**:
    - メニューから相互リンク
    - 共通ナビゲーション
    - （可能であれば）月の描画機能を28番にも追加
  - **詳細**: 後で詰める
  - UI/Canvas描画ロジックの流用検討
  - データ構造・スタイルの共通化

---

## 3. 機能仕様

### 3.1 コア機能

#### 3.1.1 日付選択
- **入力方式**: カレンダー選択（月単位表示）
- **対応期間**: ±100年間（1925年〜2125年）
- **デフォルト**: 今日の日付
- **操作**:
  - 月単位カレンダーUI
  - 前後矢印ボタン：1日ずつ移動

#### 3.1.2 月の満ち欠け表示
- **描画方式**: Canvas描画
- **月のサイズ**: 画面の33%〜50%（約3分の1）
- **月の色味**: リアル志向ベースだが、ちょっとファンタジー調（リアルすぎない）
- **背景**: 明るい星のみ散りばめる（肉眼で見える程度、暗い星は入れない）
- **表示内容**:
  - 月の満ち欠けビジュアル（リアルタイム描画）
  - 月齢（数値表示、例：「月齢 14.2日」）
  - 月の名称（新月・上弦・満月・下弦等）
- **アニメーション**: 月の満ち欠け変化をスムーズに表現

#### 3.1.3 AI生成コンテンツ（Google AI Studio）
- **生成タイミング**: 生成ボタンを押した時（手動トリガー）
- **キャッシュ**: 利用しない（毎回新しいコンテンツを生成）
- **生成内容**:
  1. **月にまつわる豆知識**
     - その日の月に関連する神話・文化・科学的知識
     - 毎回異なる内容を生成
  2. **運勢メッセージ**
     - 月の満ち欠けに合わせたメッセージ
     - 癒し・前向きなトーン
  3. **月の観測アドバイス**
     - 観測に適した時間帯
     - 天体観測のヒント

### 3.2 データ保存（ローカルストレージ）
- 閲覧履歴（最新10件）
- お気に入り日付
- APIキー（ユーザー設定）

---

## 4. 非機能要件

### 4.1 デザイン要求
- **テーマ**: ダークモード（夜空の雰囲気）
- **方向性**: リッチな表現、視覚的な癒し
- **アニメーション**:
  - 月の満ち欠け変化
  - UIトランジション
  - 背景の星のきらめき（オプション）

### 4.2 パフォーマンス
- 初回表示: 2秒以内
- Canvas描画: 60fps維持
- AI生成: バックグラウンド実行、ローディング表示

### 4.3 互換性
- モダンブラウザ（Chrome, Edge, Safari, Firefox最新版）
- モバイル・タブレット対応
- PWAとしてインストール可能

---

## 5. 技術制約

### 5.1 使用API
- **Google AI Studio API**
  - モデル: Gemini Pro推奨
  - APIキー管理: ユーザー入力 + ローカルストレージ

### 5.2 データ保存
- **ローカルストレージ**
  - 容量制限: 5MB以内
  - データ構造: JSON形式

### 5.3 天文計算
- 月齢計算アルゴリズム実装
- 基準日: 2000年1月6日 18:14 UTC（新月）

---

## 6. 画面構成

### 6.1 メイン画面
```
┌─────────────────────────────────────┐
│  🌙 月の満ち欠け表示                 │
├─────────────────────────────────────┤
│  📅 [カレンダー: 2025年1月]  ◀ ▶    │
├─────────────────────────────────────┤
│                                     │
│        [Canvas: 月の描画]            │
│       （背景：明るい星のみ）          │
│         月齢: 14.2日                │
│         満月                        │
│                                     │
├─────────────────────────────────────┤
│  [✨ AI情報を生成 ボタン]             │
├─────────────────────────────────────┤
│  💡 豆知識:                          │
│  [AI生成コンテンツ]                  │
├─────────────────────────────────────┤
│  🔮 今日のメッセージ:                 │
│  [AI生成コンテンツ]                  │
├─────────────────────────────────────┤
│  🔭 観測アドバイス:                   │
│  [AI生成コンテンツ]                  │
└─────────────────────────────────────┘
```

### 6.2 設定画面
- APIキー入力
- データクリア
- アプリ情報

---

## 7. 開発スコープ外（将来拡張）

- リアルタイム通知（満月時等）
- ソーシャル共有機能
- 天気連携（観測可能性判定）
- 月の写真ギャラリー

---

## 8. リスクと対策

### 8.1 技術リスク
| リスク | 対策 |
|--------|------|
| Canvas描画パフォーマンス低下 | 最適化、描画頻度制御 |
| AI生成の遅延 | ローディング表示、タイムアウト設定 |
| 天文計算の精度 | ライブラリ使用（SunCalc.js等） |

### 8.2 運用リスク
| リスク | 対策 |
|--------|------|
| APIキー未設定時のUX | デモモード・プレースホルダー表示 |
| API利用制限超過 | ローカルキャッシュ、リトライ機構 |

---

## 9. 次ステップ

1. ✅ 要件定義書レビュー・承認
2. ⬜ 技術設計書作成
3. ⬜ 実装計画書作成
4. ⬜ 実装開始（Claude Code on the Web）

---

**作成者**: クロ
**レビュー待ち**: あおいさん
